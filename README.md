# 🏥 노인복지용구 안내 챗봇

## 📋 **무엇을 위한 서비스인가 (목적)**

**노인복지용구 안내 전용 챗봇**: 사용자의 질문을 받아, 미리 준비된 단일 PDF(`noin3.pdf`)를 근거로 정확하고 보기 쉬운 답변을 생성합니다.

**RAG 구조**: 질문 → PDF 임베딩 검색(FAISS) → 관련 문맥을 LLM에 제공 → 마크다운 템플릿으로 정돈된 답변 출력.

**운영 편의성**: 기본적인 가드레일(주제 필터/예시 프롬프트) 과 관리자 로그 화면이 있어 서비스 운영을 최소한으로 관리할 수 있게 구성되어 있습니다.

---

## 🔄 **어떻게 동작하나 (전체 흐름)**

### **PDF → 벡터화 준비**

- **PyMuPDFLoader**로 `noin3.pdf` 페이지를 로드
- **RecursiveCharacterTextSplitter**로 문서 청크 분할
- **OpenAIEmbeddings**로 임베딩
- **FAISS**에 저장/로드

> 💡 **최초 실행 시** 벡터스토어가 없으면 생성·저장, 이후엔 디스크에서 재사용하여 속도↑.

### **질문 처리 (`/ask`)**

1. 사용자가 질문을 보내면, **가드레일**로 "너무 짧음/무의미/금지 주제" 여부를 선검증
2. 통과하면 **RAG 체인** 실행: FAISS에서 관련 청크 `k=6` 검색(점수 임계 0.5), 프롬프트 템플릿과 함께 GPT-4o 호출 → 포맷된 답변 생성
3. 결과/상태를 **CSV 로그**(`chat_log.csv`) 로 기록(시간, 질문, 답변, 상태, 분류)

### **관리자 화면 (`/admin`)**

- 간단한 비밀번호(`"1234"`) 로그인 후 최근 로그 열람 가능(`/admin/logs`)
- 카테고리 필터로 최근 질의 응답 요약 확인(`/admin/api/logs`)

---

## 🧩 **핵심 구성요소 (기능별 설명)**

### **1) RAG 파이프라인**

#### **임베딩 & 저장소**
- **OpenAIEmbeddings**로 텍스트 임베딩
- **FAISS**에 저장하고, 다음 기동 때는 `load_local`로 즉시 로딩

#### **리트리버 설정**
```python
as_retriever(search_kwargs={"k": 6, "score_threshold": 0.5})
```
→ 상위 6개 청크 중 유사도 임계 넘는 것만 문맥으로 사용

#### **프롬프트 템플릿**
- 답변은 **굵은 글씨**/체크/경고/연락처 등 마크다운 규칙을 강제
- "모르면 추측하지 말고 공단 문의 안내" 등 안전 가이드 내장

#### **LLM 호출**
- **ChatOpenAI**(`model_name="gpt-4o"`, `temperature=0`)로 일관성/사실성을 강화

### **2) 가드레일(질문 유효성 & 분류)**

- **유효성 검사**: 너무 짧은/무의미/금지 키워드(복지 주제 외) 질문 차단, 예시 질문 제시
- **카테고리 분류**: "신청방법/품목/등급신청조건/본인부담률/자격확인/기타" 등으로 간단 분류(로그용)

### **3) 로그 & 운영**

- **CSV 기반 채팅 로그**: 타임스탬프/질문/답변/상태/카테고리 저장 → 관리자 페이지에서 최신순 확인
- **관리자 인증**: 세션 기반 간단 로그인(`/admin/login`, 비번 변경 권장)

### **4) 웹 엔드포인트**

| 경로 | 설명 |
|------|------|
| `/` | 사용자용 채팅 UI 템플릿 렌더링 |
| `/ask` | 질문을 받아 RAG 체인 실행 → JSON 응답 |
| `/examples` | 가드레일이 제공하는 스타트용 예시 질문 반환 |
| `/admin/*` | 로그인/로그아웃/로그 열람 |

---

## ✅ **장점과 한계**

### **🎯 장점**

- **심플한 단일 PDF 기반**: 작은 규모 문서에 적합, 구축이 빠름
- **재사용 가능한 벡터스토어**: 최초만 임베딩 비용/시간 발생
- **운영 안전장치**: 주제 벗어난 질문 차단·완곡 안내, 답변 형식 통일

### **⚠️ 한계/주의**

- **문서가 1개**라서 범위 밖 질문엔 약함 → 문서 추가/카탈로그화 필요
- **간단 인증과 CSV 로깅**: 프로덕션에선 DB/권한/감사로그로 강화 권장
- **환경변수/비밀키 관리**: `.env`와 `ADMIN_PASSWORD`, `secret_key`는 실제 배포 시 안전하게 관리 필요

---

## 🚀 **확장 아이디어 (바로 적용 쉬움)**

- **문서 다중화**: PDF 다건 로드 + 메타데이터(카테고리/날짜)로 검색 품질 향상
- **하이브리드 검색**: 키워드(BM25) + 벡터 검색 퓨전 랭킹
- **출처 표기**: 답변 하단에 해당 페이지/청크 위치를 자동 표기
- **관리 대시보드 강화**: 카테고리별 질문 비율, 실패율, 최근 트렌드 차트


---

## 📁 **GitHub 업로드 완료된 파일들**

### **✅ 핵심 애플리케이션 파일**
- **`qa/app.py`** - 메인 Flask 챗봇 애플리케이션
- **`qa/rag.py`** - RAG 시스템 관련 코드

### **🎨 웹 템플릿 파일들**
- **`qa/templates/chat.html`** - 채팅 인터페이스
- **`qa/templates/admin_login.html`** - 관리자 로그인 페이지
- **`qa/templates/admin_logs.html`** - 관리자 로그 페이지

### **📚 프로젝트 문서**
- **`qa/README.md`** - 프로젝트 설명서 (마크다운 포맷 완성!)

### **🔒 보안상 제외된 파일들**
- `.env` - API 키 (보안)
- `__pycache__/` - Python 캐시
- `vectorstore/` - 벡터 데이터베이스 (대용량)
- `*.pdf`, `*.hwp`, `*.xlsx` - 원본 문서들
- `chat_log.csv`, `chatbot_logs.db` - 로그 데이터

> 💡 **GitHub 저장소**: [https://github.com/juo63/rag](https://github.com/juo63/rag) 
